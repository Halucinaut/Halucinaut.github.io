{{ define "main" }}
{{ if .Title }}
<header class="page-header">
  {{ partial "breadcrumbs.html" . }}
  <h1>{{ .Title }}</h1>
  {{ if .Description }}
  <div class="post-description">
    {{ .Description }}
  </div>
  {{ end }}
</header>
{{ end }}

<div class="projects-list">
{{ range .Pages }}
{{ if not .Params.parent_project }}
<article class="post-entry project-card">
  <a href="{{ .RelPermalink }}" class="card-link">
    {{ if .Params.cover.image }}
    <figure class="entry-cover">
      <img loading="lazy" src="{{ .Params.cover.image | absURL }}" alt="{{ .Params.cover.alt }}" />
    </figure>
    {{ end }}
    <div class="card-body">
      <header class="entry-header">
        <h2>{{ .Title }}</h2>
      </header>
      {{ if .Summary }}
      <p class="card-summary">{{ .Summary }}</p>
      {{ end }}
      {{ if .Params.tags }}
      <div class="card-tags">
        {{ range .Params.tags }}
        <span class="tag">{{ . }}</span>
        {{ end }}
      </div>
      {{ end }}
      <div class="card-footer">
        <span class="post-date">{{ .Date.Format "01-02" }}</span>
        <span class="likes">{{ .Params.likes | default 0 }}</span>
      </div>
    </div>
  </a>
</article>
{{ end }}
{{ end }}
</div>

{{ if gt .Paginator.TotalPages 1 }}
<footer class="page-footer">
  <nav class="pagination">
    {{ if .Paginator.HasPrev }}
    <a class="prev" href="{{ .Paginator.Prev.URL | absURL }}">← {{ i18n "prev_page" }}</a>
    {{ end }}
    {{ if .Paginator.HasNext }}
    <a class="next" href="{{ .Paginator.Next.URL | absURL }}">{{ i18n "next_page" }} →</a>
    {{ end }}
  </nav>
</footer>
{{ end }}

<script>
// 检测标题是否超出容器宽度，超出则添加 data-overflow 属性
document.addEventListener('DOMContentLoaded', function() {
    const titles = document.querySelectorAll('.projects-list .project-card .entry-header h2');
    titles.forEach(function(title) {
        const container = title.parentElement;
        if (title.scrollWidth > container.clientWidth) {
            title.setAttribute('data-overflow', 'true');
        }
    });
});
</script>
{{ end }}
